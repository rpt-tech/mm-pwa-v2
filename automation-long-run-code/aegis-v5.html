<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AEGIS v5.2 ‚Äî Autonomous Engineering Framework</title>
  <link
    href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Newsreader:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Outfit:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --bg: #08090b;
      --s1: #0f1114;
      --s2: #171b21;
      --s3: #1e2430;
      --border: #2a3040;
      --t1: #eae8e4;
      --t2: #a0a8b8;
      --t3: #606878;
      --amber: #f5a623;
      --cyan: #2dd4bf;
      --violet: #a78bfa;
      --rose: #fb7185;
      --lime: #a3e635;
      --blue: #60a5fa;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box
    }

    body {
      background: var(--bg);
      color: var(--t1);
      font-family: 'Outfit', sans-serif;
      line-height: 1.75;
      -webkit-font-smoothing: antialiased
    }

    .wrap {
      max-width: 860px;
      margin: 0 auto;
      padding: 2.5rem 1.5rem 5rem
    }

    .hero {
      padding: 3rem 0 2.5rem;
      border-bottom: 1px solid var(--border);
      margin-bottom: 2.5rem
    }

    .hero .tag {
      display: inline-block;
      font-family: 'JetBrains Mono', monospace;
      font-size: .6rem;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: var(--amber);
      border: 1px solid rgba(245, 166, 35, .3);
      padding: .2rem .7rem;
      border-radius: 2px;
      margin-bottom: 1.2rem
    }

    .hero h1 {
      font-family: 'Newsreader', serif;
      font-size: clamp(2.2rem, 5vw, 3.2rem);
      font-weight: 300;
      line-height: 1.15;
      margin-bottom: .6rem
    }

    .hero h1 b {
      font-weight: 600;
      color: var(--amber)
    }

    .hero p {
      color: var(--t2);
      font-size: .95rem;
      max-width: 580px
    }

    .step {
      margin: 3rem 0;
      padding: 2rem 0 0
    }

    .step-head {
      display: flex;
      align-items: center;
      gap: .75rem;
      margin-bottom: 1.5rem;
      padding-bottom: .75rem;
      border-bottom: 1px solid var(--border)
    }

    .step-num {
      font-family: 'JetBrains Mono', monospace;
      font-size: .65rem;
      letter-spacing: .1em;
      color: var(--bg);
      background: var(--amber);
      padding: .2rem .55rem;
      border-radius: 2px;
      font-weight: 600
    }

    .step-num.g {
      background: var(--lime);
      color: #111
    }

    .step-num.c {
      background: var(--cyan);
      color: #111
    }

    .step-num.v {
      background: var(--violet)
    }

    .step-num.r {
      background: var(--rose);
      color: #111
    }

    .step-num.b {
      background: var(--blue);
      color: #111
    }

    .step-title {
      font-family: 'Newsreader', serif;
      font-size: 1.5rem;
      font-weight: 400
    }

    h3 {
      font-size: .95rem;
      font-weight: 600;
      color: var(--cyan);
      margin: 1.75rem 0 .6rem
    }

    h4 {
      font-family: 'JetBrains Mono', monospace;
      font-size: .7rem;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: var(--violet);
      margin: 1.5rem 0 .5rem
    }

    p {
      margin-bottom: .85rem;
      font-size: .92rem
    }

    pre {
      background: var(--s1);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 1.1rem 1.3rem;
      overflow-x: auto;
      margin: .8rem 0;
      font-family: 'JetBrains Mono', monospace;
      font-size: .73rem;
      line-height: 1.9;
      color: #c4cad6;
      position: relative
    }

    pre .label {
      position: absolute;
      top: 0;
      right: 0;
      font-size: .55rem;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--t3);
      background: var(--s2);
      padding: .2rem .6rem;
      border-radius: 0 5px 0 4px;
      border-left: 1px solid var(--border);
      border-bottom: 1px solid var(--border)
    }

    code {
      font-family: 'JetBrains Mono', monospace;
      font-size: .78rem;
      background: var(--s2);
      padding: .12rem .35rem;
      border-radius: 3px;
      color: var(--cyan)
    }

    pre code {
      background: none;
      padding: 0;
      color: inherit
    }

    .cm {
      color: #546178
    }

    .kw {
      color: #f97583
    }

    .st {
      color: #9ecbff
    }

    .fn {
      color: #b392f0
    }

    .vr {
      color: #79b8ff
    }

    .note {
      background: var(--s1);
      border-left: 3px solid var(--amber);
      padding: .9rem 1.1rem;
      margin: 1rem 0;
      border-radius: 0 4px 4px 0;
      font-size: .88rem
    }

    .note.warn {
      border-left-color: var(--rose);
      background: rgba(251, 113, 133, .04)
    }

    .note.ok {
      border-left-color: var(--lime);
      background: rgba(163, 230, 53, .04)
    }

    .note.info {
      border-left-color: var(--blue);
      background: rgba(96, 165, 250, .04)
    }

    .note b {
      color: var(--amber)
    }

    .note.warn b {
      color: var(--rose)
    }

    .note.ok b {
      color: var(--lime)
    }

    .note.info b {
      color: var(--blue)
    }

    .tree {
      background: var(--s1);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 1.1rem 1.4rem;
      margin: .8rem 0;
      font-family: 'JetBrains Mono', monospace;
      font-size: .7rem;
      line-height: 2.1;
      color: var(--t3)
    }

    .tree .d {
      color: var(--cyan);
      font-weight: 500
    }

    .tree .f {
      color: var(--t1)
    }

    .tree .h {
      color: var(--amber);
      font-weight: 600
    }

    .tree .dim {
      color: #3a4050
    }

    .tree .new {
      color: var(--lime);
      font-weight: 600
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: .8rem 0;
      font-size: .85rem
    }

    th {
      text-align: left;
      font-family: 'JetBrains Mono', monospace;
      font-size: .65rem;
      letter-spacing: .06em;
      text-transform: uppercase;
      color: var(--t3);
      padding: .65rem .6rem;
      border-bottom: 1px solid var(--border)
    }

    td {
      padding: .65rem .6rem;
      border-bottom: 1px solid rgba(42, 48, 64, .4);
      vertical-align: top
    }

    td code {
      font-size: .7rem
    }

    .prompt-box {
      background: linear-gradient(135deg, rgba(245, 166, 35, .06), rgba(45, 212, 191, .04));
      border: 1px solid rgba(245, 166, 35, .2);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1rem 0
    }

    .prompt-box .label-tag {
      font-family: 'JetBrains Mono', monospace;
      font-size: .6rem;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--amber);
      margin-bottom: .6rem;
      display: block
    }

    .prompt-box .example {
      font-family: 'Newsreader', serif;
      font-size: 1.05rem;
      font-style: italic;
      color: var(--t1);
      line-height: 1.6
    }

    .steer-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: .8rem;
      margin: .8rem 0
    }

    .steer-card {
      background: var(--s1);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: .9rem 1rem
    }

    .steer-card .icon {
      font-size: 1.1rem;
      margin-bottom: .3rem
    }

    .steer-card .cmd {
      font-family: 'JetBrains Mono', monospace;
      font-size: .72rem;
      color: var(--cyan);
      margin-bottom: .3rem
    }

    .steer-card .desc {
      font-size: .78rem;
      color: var(--t2)
    }

    .diff-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: .8rem;
      margin: .8rem 0
    }

    .diff-box {
      background: var(--s1);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: .9rem 1rem
    }

    .diff-box .diff-label {
      font-family: 'JetBrains Mono', monospace;
      font-size: .6rem;
      letter-spacing: .1em;
      text-transform: uppercase;
      margin-bottom: .5rem
    }

    .diff-box.old .diff-label {
      color: var(--rose)
    }

    .diff-box.new .diff-label {
      color: var(--lime)
    }

    .diff-box ul {
      list-style: none;
      font-size: .8rem;
      color: var(--t2)
    }

    .diff-box ul li {
      padding: .15rem 0
    }

    .diff-box.old ul li::before {
      content: "‚úó ";
      color: var(--rose)
    }

    .diff-box.new ul li::before {
      content: "‚úì ";
      color: var(--lime)
    }

    footer {
      margin-top: 3rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
      text-align: center;
      font-size: .75rem;
      color: var(--t3)
    }

    .feat-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: .75rem;
      margin: 1rem 0
    }

    .feat-card {
      background: var(--s1);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 1rem 1.1rem
    }

    .feat-card .fc-label {
      font-family: 'JetBrains Mono', monospace;
      font-size: .58rem;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--amber);
      margin-bottom: .5rem;
      display: block
    }

    .feat-card .fc-title {
      font-size: .88rem;
      font-weight: 600;
      color: var(--t1);
      margin-bottom: .35rem
    }

    .feat-card .fc-desc {
      font-size: .78rem;
      color: var(--t2);
      line-height: 1.55
    }

    .feat-card.cyan { border-left: 3px solid var(--cyan) }
    .feat-card.amber { border-left: 3px solid var(--amber) }
    .feat-card.violet { border-left: 3px solid var(--violet) }
    .feat-card.lime { border-left: 3px solid var(--lime) }
    .feat-card.rose { border-left: 3px solid var(--rose) }
    .feat-card.blue { border-left: 3px solid var(--blue) }

    @media(max-width:640px) {
      .feat-grid { grid-template-columns: 1fr }
    }

    @media(max-width:640px) {
      .wrap {
        padding: 1rem
      }

      pre {
        font-size: .65rem;
        padding: .75rem
      }

      .steer-grid {
        grid-template-columns: 1fr
      }

      .diff-grid {
        grid-template-columns: 1fr
      }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="hero">
      <div class="tag">AEGIS v5.2 ‚Äî Autonomous Engineering Framework</div>
      <h1>Vi·∫øt m·ªôt c√¢u.<br><b>AI t·ª± l√†m h·∫øt.</b></h1>
      <p>Framework autonomous coding ch·∫°y nhi·ªÅu ng√†y. User ch·ªâ c·∫ßn 1 prompt ban ƒë·∫ßu. M·ªçi th·ª© kh√°c AI t·ª± x·ª≠ l√Ω ‚Äî checkpoint/rollback, dependency graph, thrashing detection, staging deploy, worker heartbeat, <strong>multi-agent parallel</strong>, Stop hook, supervision_level, existing codebase mode, v√† <strong>semantic memory index</strong>.</p>
    </div>

    <!-- FEATURES -->
    <div class="step">
      <div class="step-head">
        <span class="step-num">FEATURES</span>
        <span class="step-title">To√†n b·ªô t√≠nh nƒÉng c·ªßa framework</span>
      </div>

      <h3>Autonomous Execution</h3>
      <div class="feat-grid">
        <div class="feat-card cyan">
          <span class="fc-label">Core Loop</span>
          <div class="fc-title">Coding loop t·ª± ƒë·ªông</div>
          <div class="fc-desc">Agent ch·ªçn feature ‚Üí implement ‚Üí build/test ‚Üí commit ‚Üí l·∫∑p l·∫°i. Kh√¥ng c·∫ßn ng∆∞·ªùi ng·ªìi canh. Ch·∫°y li√™n t·ª•c nhi·ªÅu ng√†y.</div>
        </div>
        <div class="feat-card cyan">
          <span class="fc-label">Feature Queue</span>
          <div class="fc-title">feature_list.json v·ªõi dependency graph</div>
          <div class="fc-desc"><code>depends_on</code> field + topological sort. Feature ch·ªâ ƒë∆∞·ª£c pick khi t·∫•t c·∫£ dependencies ƒë√£ pass. Orchestrator d√πng ƒë·ªÉ assign cho workers.</div>
        </div>
        <div class="feat-card cyan">
          <span class="fc-label">Multi-Agent</span>
          <div class="fc-title">Parallel workers v·ªõi git worktrees</div>
          <div class="fc-desc">Orchestrator + N workers, m·ªói worker c√≥ git worktree ri√™ng. Auto-switch khi ‚â•20 features pending. Workers commit v√†o branches ri√™ng, orchestrator merge.</div>
        </div>
        <div class="feat-card cyan">
          <span class="fc-label">Phase Management</span>
          <div class="fc-title">Auto-generate phases ti·∫øp theo</div>
          <div class="fc-desc">Khi h·∫øt features, agent t·ª± generate phase ti·∫øp theo d·ª±a tr√™n BLUEPRINT.md. Kh√¥ng c·∫ßn user can thi·ªáp gi·ªØa c√°c phases.</div>
        </div>
      </div>

      <h3>Resilience & Recovery</h3>
      <div class="feat-grid">
        <div class="feat-card amber">
          <span class="fc-label">Checkpoint</span>
          <div class="fc-title">Git tag tr∆∞·ªõc m·ªói feature</div>
          <div class="fc-desc"><code>git tag checkpoint/pre-feature-N</code> tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu. N·∫øu feature blocked sau 3 retries ‚Üí auto rollback v·ªÅ checkpoint s·∫°ch.</div>
        </div>
        <div class="feat-card amber">
          <span class="fc-label">Loop Detection</span>
          <div class="fc-title">Thrashing detection</div>
          <div class="fc-desc">&gt;10 commits trong 30 ph√∫t v·ªõi 0 feature m·ªõi pass ‚Üí ph√°t hi·ªán thrashing ‚Üí fresh restart thay v√¨ ti·∫øp t·ª•c loop v√¥ √≠ch.</div>
        </div>
        <div class="feat-card amber">
          <span class="fc-label">Watchdog</span>
          <div class="fc-title">Auto-restart + budget guard</div>
          <div class="fc-desc">Stall 40 ph√∫t ‚Üí force restart. API crash ‚Üí restart v·ªõi context recovery. H·∫øt credit ‚Üí ch·ªù 15 ph√∫t retry. Budget exceeded ‚Üí d·ª´ng an to√†n.</div>
        </div>
        <div class="feat-card amber">
          <span class="fc-label">State Snapshot</span>
          <div class="fc-title">.last_state.json cross-session</div>
          <div class="fc-desc">Ghi tr·∫°ng th√°i hi·ªán t·∫°i tr∆∞·ªõc m·ªói feature. Session m·ªõi ƒë·ªçc l·∫°i ‚Üí bi·∫øt ch√≠nh x√°c ƒëang l√†m g√¨, kh√¥ng m·∫•t context khi restart.</div>
        </div>
        <div class="feat-card amber">
          <span class="fc-label">Worker Heartbeat</span>
          <div class="fc-title">Dead worker detection</div>
          <div class="fc-desc">Worker ghi HEARTBEAT file m·ªói 60s. Orchestrator detect n·∫øu &gt;300s kh√¥ng update ‚Üí respawn worker t·ª± ƒë·ªông.</div>
        </div>
        <div class="feat-card amber">
          <span class="fc-label">--continue Timeout</span>
          <div class="fc-title">Corrupt session guard</div>
          <div class="fc-desc">Sau --continue, n·∫øu 10 ph√∫t kh√¥ng c√≥ commit m·ªõi ‚Üí kill session corrupt, fresh start thay v√¨ ti·∫øp t·ª•c session h·ªèng.</div>
        </div>
      </div>

      <h3>Memory & Context</h3>
      <div class="feat-grid">
        <div class="feat-card violet">
          <span class="fc-label">Persistent Memory</span>
          <div class="fc-title">CLAUDE.md ‚Äî auto-read m·ªói session</div>
          <div class="fc-desc">Claude Code ƒë·ªçc CLAUDE.md t·ª± ƒë·ªông khi start. Ch·ª©a: role detection, session protocol, non-negotiable rules, common mistakes, codebase context.</div>
        </div>
        <div class="feat-card violet">
          <span class="fc-label">Semantic Memory</span>
          <div class="fc-title">.memory/index.json ‚Äî v5.2</div>
          <div class="fc-desc">Index to√†n b·ªô src/ (file paths, exports, descriptions). Agent search tr∆∞·ªõc khi implement ‚Üí t√¨m code li√™n quan, tr√°nh duplicate. Rebuild async sau m·ªói feature pass.</div>
        </div>
        <div class="feat-card violet">
          <span class="fc-label">Codebase Scan</span>
          <div class="fc-title">CODEBASE_SCAN.md ‚Äî existing mode</div>
          <div class="fc-desc">Bootstrap scan to√†n b·ªô codebase hi·ªán c√≥: tech stack, entry points, existing features, ENV keys present/missing. Agent kh√¥ng rebuild nh·ªØng g√¨ ƒë√£ c√≥.</div>
        </div>
        <div class="feat-card violet">
          <span class="fc-label">Common Mistakes</span>
          <div class="fc-title">Self-learning error memory</div>
          <div class="fc-desc">Khi g·∫∑p l·ªói l·∫∑p l·∫°i, agent t·ª± append v√†o CLAUDE.md "Common Mistakes" section. C√°c session sau ƒë·ªçc l·∫°i ‚Üí kh√¥ng l·∫∑p l·ªói c≈©.</div>
        </div>
      </div>

      <h3>Quality Gates</h3>
      <div class="feat-grid">
        <div class="feat-card lime">
          <span class="fc-label">Build + Test</span>
          <div class="fc-title">passes=true ch·ªâ khi exit code 0</div>
          <div class="fc-desc">Feature ch·ªâ ƒë∆∞·ª£c commit khi build pass V√Ä test pass. Kh√¥ng c√≥ exception. Fail ‚Üí retry_count++, sau 3 l·∫ßn ‚Üí blocked + rollback.</div>
        </div>
        <div class="feat-card lime">
          <span class="fc-label">Integration Tests</span>
          <div class="fc-title">Sau m·ªói 5 features ho·∫∑c cu·ªëi category</div>
          <div class="fc-desc">Ch·∫°y integration test suite sau m·ªói 5 features ho·∫∑c khi ho√†n th√†nh m·ªôt category. Ph√°t hi·ªán regression s·ªõm tr∆∞·ªõc khi t√≠ch l≈©y.</div>
        </div>
        <div class="feat-card lime">
          <span class="fc-label">Lint Hook</span>
          <div class="fc-title">PostToolUse async lint</div>
          <div class="fc-desc"><code>.claude/settings.json</code> hook ch·∫°y <code>tsc --noEmit</code> async sau m·ªói Write/Edit. Kh√¥ng block agent nh∆∞ng log l·ªói v√†o LIVE_LOG.md.</div>
        </div>
        <div class="feat-card lime">
          <span class="fc-label">Stop Hook</span>
          <div class="fc-title">NgƒÉn agent d·ª´ng s·ªõm</div>
          <div class="fc-desc">Claude Code Stop hook ki·ªÉm tra feature_list.json tr∆∞·ªõc khi cho ph√©p agent exit. C√≤n pending features ‚Üí agent ti·∫øp t·ª•c thay v√¨ d·ª´ng.</div>
        </div>
      </div>

      <h3>Human-in-the-Loop Controls</h3>
      <div class="feat-grid">
        <div class="feat-card rose">
          <span class="fc-label">Supervision Level</span>
          <div class="fc-title">Two-speed workflow per feature</div>
          <div class="fc-desc"><code>"auto"</code>: agent t·ª± commit. <code>"supervised"</code>: agent d·ª´ng tr∆∞·ªõc commit, ghi v√†o NEEDS.md, ch·ªù <code>approve #ID</code> trong STEERING.md. D√πng cho payment, security, core logic.</div>
        </div>
        <div class="feat-card rose">
          <span class="fc-label">STEERING.md</span>
          <div class="fc-title">Real-time control t·ª´ phone/SSH</div>
          <div class="fc-desc">Vi·∫øt l·ªánh v√†o STEERING.md b·∫•t k·ª≥ l√∫c n√†o: fix bug, skip feature, add feature, change direction, cung c·∫•p credentials, pause, approve supervised.</div>
        </div>
        <div class="feat-card rose">
          <span class="fc-label">Slash Commands</span>
          <div class="fc-title">/status /unblock /rollback</div>
          <div class="fc-desc">Custom Claude Code slash commands. <code>/status</code>: health dashboard. <code>/unblock N</code>: reset blocked feature. <code>/rollback N</code>: git reset v·ªÅ checkpoint.</div>
        </div>
        <div class="feat-card rose">
          <span class="fc-label">NEEDS.md</span>
          <div class="fc-title">AI h·ªèi, b·∫°n tr·∫£ l·ªùi khi n√†o ti·ªán</div>
          <div class="fc-desc">AI li·ªát k√™ credentials c·∫ßn thi·∫øt nh∆∞ng kh√¥ng ch·ªù. Code v·ªõi mock data tr∆∞·ªõc. Existing mode: ch·ªâ h·ªèi keys th·ª±c s·ª± c√≤n thi·∫øu (keys ƒë√£ c√≥ trong .env ‚Üí [x] ngay).</div>
        </div>
      </div>

      <h3>Cost Management</h3>
      <div class="feat-grid">
        <div class="feat-card blue">
          <span class="fc-label">Budget Guard</span>
          <div class="fc-title">MAX_COST_USD hard cap</div>
          <div class="fc-desc">Watchdog ∆∞·ªõc t√≠nh cost m·ªói session (~$9/session Opus 4.6). V∆∞·ª£t MAX_COST_USD ‚Üí t·∫°o file BUDGET_EXCEEDED ‚Üí d·ª´ng an to√†n. TƒÉng cap ho·∫∑c x√≥a file ƒë·ªÉ ti·∫øp t·ª•c.</div>
        </div>
        <div class="feat-card blue">
          <span class="fc-label">Alert Threshold</span>
          <div class="fc-title">ALERT_COST_USD warning</div>
          <div class="fc-desc">Khi ƒë·∫°t ALERT_COST_USD (default $30), ghi c·∫£nh b√°o v√†o LIVE_LOG.md. B·∫°n bi·∫øt tr∆∞·ªõc khi ƒë·∫øn hard cap.</div>
        </div>
        <div class="feat-card blue">
          <span class="fc-label">Cost Tracker</span>
          <div class="fc-title">COST_TRACKER.md session log</div>
          <div class="fc-desc">Ghi ∆∞·ªõc t√≠nh cost m·ªói session. Xem l·∫°i ƒë·ªÉ bi·∫øt project ƒë√£ t·ªën bao nhi√™u v√† c√≤n bao nhi√™u budget.</div>
        </div>
      </div>

      <h3>Deploy Pipeline</h3>
      <div class="feat-grid">
        <div class="feat-card cyan">
          <span class="fc-label">Staging First</span>
          <div class="fc-title">Staging ‚Üí health check ‚Üí production</div>
          <div class="fc-desc">Kh√¥ng deploy th·∫≥ng production. Deploy staging ‚Üí ch·∫°y health check ‚Üí n·∫øu pass ‚Üí promote production. Fail ‚Üí rollback staging, kh√¥ng ·∫£nh h∆∞·ªüng production.</div>
        </div>
        <div class="feat-card cyan">
          <span class="fc-label">Multi-target</span>
          <div class="fc-title">Vercel, Cloudflare, Modal, Supabase</div>
          <div class="fc-desc">H·ªó tr·ª£: Vercel (frontend), Cloudflare Workers (API), Modal (compute), Supabase (DB), Cloudflare R2 (storage). C·∫•u h√¨nh trong AEGIS.md.</div>
        </div>
        <div class="feat-card cyan">
          <span class="fc-label">GitHub Actions</span>
          <div class="fc-title">CI/CD pipeline t·ª± ƒë·ªông</div>
          <div class="fc-desc">Bootstrap t·∫°o .github/workflows/ v·ªõi build, test, deploy jobs. T√≠ch h·ª£p v·ªõi staging/production pipeline.</div>
        </div>
      </div>

      <h3>Existing Codebase Support</h3>
      <div class="feat-grid">
        <div class="feat-card violet">
          <span class="fc-label">Auto-detect</span>
          <div class="fc-title">PROJECT_MODE: auto</div>
          <div class="fc-desc">T·ª± detect existing codebase: c√≥ src/, .env, node_modules, ho·∫∑c git history ‚Üí existing mode. Kh√¥ng c·∫ßn config th·ªß c√¥ng.</div>
        </div>
        <div class="feat-card violet">
          <span class="fc-label">Deep Scan</span>
          <div class="fc-title">Codebase exploration tr∆∞·ªõc khi plan</div>
          <div class="fc-desc">Scan file tree, ƒë·ªçc entry points, core logic files, git history. Identify: framework, DB layer, auth method, existing features. T·∫°o CODEBASE_SCAN.md.</div>
        </div>
        <div class="feat-card violet">
          <span class="fc-label">.env-aware</span>
          <div class="fc-title">Validate thay v√¨ overwrite</div>
          <div class="fc-desc">init.sh kh√¥ng overwrite .env hi·ªán c√≥. ƒê·ªçc keys present/missing, b√°o c√°o thi·∫øu g√¨. NEEDS.md ch·ªâ h·ªèi keys th·ª±c s·ª± ch∆∞a c√≥ gi√° tr·ªã.</div>
        </div>
        <div class="feat-card violet">
          <span class="fc-label">Extend, not rebuild</span>
          <div class="fc-title">feature_list.json ch·ªâ ch·ª©a features M·ªöI</div>
          <div class="fc-desc">Cross-reference v·ªõi CODEBASE_SCAN.md "Existing Features". Kh√¥ng t·∫°o l·∫°i nh·ªØng g√¨ ƒë√£ implement. Features m·ªõi c√≥ <code>existing_context</code> field.</div>
        </div>
      </div>
    </div>

    <!-- Step 00 -->
    <div class="step">
      <div class="step-head">
        <span class="step-num">00</span>
        <span class="step-title">C√†i ƒë·∫∑t m·ªôt l·∫ßn duy nh·∫•t</span>
      </div>

      <pre><span class="label">terminal</span>
<span class="cm"># 1. C√†i Claude Code</span>
npm install -g @anthropic-ai/claude-code   <span class="cm"># ho·∫∑c brew install claude-code</span>

<span class="cm"># 2. C√†i tmux</span>
brew install tmux                          <span class="cm"># macOS</span>
sudo apt install tmux                      <span class="cm"># Ubuntu/WSL</span>

<span class="cm"># 3. C√†i jq (d√πng ƒë·ªÉ parse feature_list.json)</span>
brew install jq                            <span class="cm"># macOS</span>
sudo apt install jq                        <span class="cm"># Ubuntu/WSL</span>

<span class="cm"># 4. Verify</span>
claude --version                           <span class="cm"># c·∫ßn >= 2.x</span>
claude doctor

<span class="cm"># 5. Set Opus 4.6 l√†m default</span>
<span class="kw">export</span> ANTHROPIC_MODEL=claude-opus-4-6
<span class="kw">export</span> CLAUDE_CODE_EFFORT_LEVEL=high
<span class="cm"># Th√™m 2 d√≤ng tr√™n v√†o ~/.bashrc ho·∫∑c ~/.zshrc</span></pre>
    </div>

    <!-- Step 01 -->
    <div class="step">
      <div class="step-head">
        <span class="step-num">01</span>
        <span class="step-title">T·∫°o AEGIS.md ‚Äî Ch·ªâ 1 file</span>
      </div>

      <p>T·∫°o folder project m·ªõi (ho·∫∑c <code>cd</code> v√†o project ƒë√£ c√≥), t·∫°o ƒë√∫ng <strong>1 file duy nh·∫•t</strong>: <code>AEGIS.md</code>. Paste n·ªôi dung t·ª´
        <code>aegis.md</code> trong repo n√†y, thay ph·∫ßn <code>[Y√äU C·∫¶U C·ª¶A B·∫†N]</code>. Xong.</p>

      <div class="note ok">
        <b>Project ƒë√£ c√≥ s·∫µn code?</b> Set <code>PROJECT_MODE: existing</code> trong AEGIS.md (ho·∫∑c ƒë·ªÉ <code>auto</code> ‚Äî AI t·ª± detect). Bootstrap s·∫Ω scan to√†n b·ªô codebase tr∆∞·ªõc khi plan.
      </div>

      <div class="prompt-box">
        <span class="label-tag">V√≠ d·ª• y√™u c·∫ßu user vi·∫øt</span>
        <div class="example">"T√¥i mu·ªën t·∫°o m·ªôt SaaS dashboard cho qu·∫£n l√Ω inventory c·ªßa chu·ªói si√™u th·ªã. C√≥ real-time
          stock tracking, low-stock alerts qua email/Telegram, barcode scanning t·ª´ mobile, v√† reporting dashboard. Tech:
          Next.js + Supabase. Deploy l√™n Vercel + Cloudflare Workers cho API."</div>
      </div>

      <h3>C·∫•u tr√∫c file sau khi Bootstrap (Phase 0)</h3>

      <div class="tree">
        my-project/<br>
        ‚îú‚îÄ‚îÄ <span class="h">AEGIS.md</span> <span class="dim">‚Üê file duy nh·∫•t b·∫°n t·∫°o</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">CLAUDE.md</span> <span class="dim">‚Üê persistent memory, Claude ƒë·ªçc t·ª± ƒë·ªông</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">BLUEPRINT.md</span> <span class="dim">‚Üê architecture + phases</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">feature_list.json</span> <span class="dim">‚Üê 10-20 features (with depends_on)</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">.last_state.json</span> <span class="dim">‚Üê v5: state snapshot for context recovery</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">NEEDS.md</span> <span class="dim">‚Üê credentials c·∫ßn t·ª´ b·∫°n</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">CODEBASE_SCAN.md</span> <span class="dim">‚Üê [existing mode] k·∫øt qu·∫£ scan codebase hi·ªán c√≥</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">PROGRESS.md</span> <span class="dim">‚Üê feature completion log</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">LIVE_LOG.md</span> <span class="dim">‚Üê real-time action log</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">STEERING.md</span> <span class="dim">‚Üê b·∫°n vi·∫øt l·ªánh v√†o ƒë√¢y</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">BLOCKED.md</span> <span class="dim">‚Üê features b·ªã stuck (auto-rollback)</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">COST_TRACKER.md</span> <span class="dim">‚Üê session cost log</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">WORKERS.md</span> <span class="dim">‚Üê multi-agent worker status</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">init.sh</span> <span class="dim">‚Üê bootstrap dev env (idempotent)</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">.claude/</span><br>
        ‚îÇ ‚îú‚îÄ‚îÄ <span class="new">settings.local.json</span><br>
        ‚îÇ ‚îú‚îÄ‚îÄ <span class="new">settings.json</span> <span class="dim">‚Üê v5.1: hooks (Stop + PostToolUse)</span><br>
        ‚îÇ ‚îú‚îÄ‚îÄ <span class="new">hooks/lint-check.sh</span> <span class="dim">‚Üê async lint after each file edit</span><br>
        ‚îÇ ‚îî‚îÄ‚îÄ <span class="new">commands/</span> <span class="dim">‚Üê /status, /unblock, /rollback slash commands</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">scripts/</span><br>
        ‚îÇ ‚îú‚îÄ‚îÄ <span class="new">agent-watchdog.sh</span> <span class="dim">‚Üê v5: thrashing detection + --continue timeout</span><br>
        ‚îÇ ‚îú‚îÄ‚îÄ <span class="new">health-check.sh</span><br>
        ‚îÇ ‚îú‚îÄ‚îÄ <span class="new">aegis-start.sh</span><br>
        ‚îÇ ‚îú‚îÄ‚îÄ <span class="new">multi-agent.sh</span> <span class="dim">‚Üê v5: heartbeat + dependency-aware</span><br>
        ‚îÇ ‚îú‚îÄ‚îÄ <span class="new">memory-index.sh</span> <span class="dim">‚Üê v5.2: build semantic memory index</span><br>
        ‚îÇ ‚îî‚îÄ‚îÄ <span class="new">memory-search.sh</span> <span class="dim">‚Üê v5.2: query index tr∆∞·ªõc khi implement</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">.memory/</span> <span class="dim">‚Üê v5.2: index.json (file paths + exports + descriptions)</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">logs/</span> <span class="dim">‚Üê rotated LIVE_LOG archives</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">tests/</span> <span class="dim">‚Üê v5: integration test suite</span><br>
        ‚îî‚îÄ‚îÄ <span class="d">src/</span> <span class="dim">‚Üê code b·∫Øt ƒë·∫ßu xu·∫•t hi·ªán ·ªü ƒë√¢y</span>
      </div>
    </div>

    <!-- Step 02 -->
    <div class="step">
      <div class="step-head">
        <span class="step-num g">02</span>
        <span class="step-title">Kh·ªüi ƒë·ªông ‚Äî ƒê√∫ng 2 l·ªánh</span>
      </div>

      <pre><span class="label">terminal ‚Äî greenfield (project m·ªõi)</span>
<span class="cm"># 1. T·∫°o folder m·ªõi, th√™m AEGIS.md</span>
<span class="kw">mkdir</span> my-project &amp;&amp; <span class="kw">cd</span> my-project
<span class="cm"># (t·∫°o AEGIS.md v·ªõi y√™u c·∫ßu c·ªßa b·∫°n)</span>

<span class="cm"># 2. Bootstrap + b·∫Øt ƒë·∫ßu code</span>
claude --model claude-opus-4-6 --dangerously-skip-permissions \
  -p <span class="st">"ƒê·ªçc AEGIS.md v√† th·ª±c hi·ªán Phase 0: Bootstrap. T·∫°o t·∫•t c·∫£ files c·∫ßn thi·∫øt r·ªìi b·∫Øt ƒë·∫ßu code Phase 1 ngay."</span></pre>

      <pre><span class="label">terminal ‚Äî existing codebase (project ƒë√£ c√≥ s·∫µn)</span>
<span class="cm"># 1. V√†o project ƒë√£ c√≥, th√™m AEGIS.md (set PROJECT_MODE: existing ho·∫∑c auto)</span>
<span class="kw">cd</span> /path/to/existing-project
<span class="cm"># (t·∫°o AEGIS.md v·ªõi y√™u c·∫ßu + PROJECT_MODE: existing)</span>

<span class="cm"># 2. Bootstrap ‚Äî AI s·∫Ω scan codebase tr∆∞·ªõc khi plan</span>
claude --model claude-opus-4-6 --dangerously-skip-permissions \
  -p <span class="st">"ƒê·ªçc AEGIS.md v√† th·ª±c hi·ªán Phase 0: Bootstrap. Scan to√†n b·ªô codebase hi·ªán c√≥, t·∫°o CODEBASE_SCAN.md, r·ªìi plan v√† b·∫Øt ƒë·∫ßu code."</span></pre>

      <div class="note ok">
        <b>Sau khi Initializer ch·∫°y xong</b>, project s·∫Ω c√≥: BLUEPRINT.md, feature_list.json (10-20 features cho phase
        1-2), CLAUDE.md (persistent memory), NEEDS.md, governance files, scripts, v√† agent ƒë√£ b·∫Øt ƒë·∫ßu code Phase 1.
        <br><br>
        <b>[Existing mode]</b> Th√™m: CODEBASE_SCAN.md (tech stack, existing features, ENV status), NEEDS.md ch·ªâ li·ªát k√™ keys th·ª±c s·ª± c√≤n thi·∫øu, feature_list.json ch·ªâ ch·ª©a features M·ªöI (kh√¥ng rebuild nh·ªØng g√¨ ƒë√£ c√≥).
      </div>

      <h3>Chuy·ªÉn sang ch·∫°y t·ª± ƒë·ªông li√™n t·ª•c</h3>

      <pre><span class="label">scripts/agent-watchdog.sh ‚Äî v5: thrashing detection + --continue timeout + state snapshot</span>
#!/usr/bin/env bash
WORKDIR="$(cd "$(dirname "$0")/.." && pwd)"
LOG="$WORKDIR/LIVE_LOG.md"
RESTART_DELAY=45
MAX_RESTARTS=500
CREDIT_WAIT=900
STALL_TIMEOUT=2400    <span class="cm"># 40 ph√∫t kh√¥ng c√≥ commit ‚Üí restart</span>
CONTINUE_TIMEOUT=600  <span class="cm"># v5: 10 ph√∫t sau --continue m√† kh√¥ng commit ‚Üí kill + fresh</span>

<span class="cm"># ƒê·ªçc budget t·ª´ AEGIS.md</span>
MAX_COST=$(grep -oP 'MAX_COST_USD:\s*\K[0-9]+' "$WORKDIR/AEGIS.md" 2>/dev/null || echo 50)
ALERT_COST=$(grep -oP 'ALERT_COST_USD:\s*\K[0-9]+' "$WORKDIR/AEGIS.md" 2>/dev/null || echo 30)
SESSION_COST_EST=9    <span class="cm"># ∆∞·ªõc t√≠nh $9/session Opus 4.6 normal</span>

<span class="kw">export</span> CLAUDE_CODE_MAX_OUTPUT_TOKENS=128000
<span class="kw">export</span> ANTHROPIC_MODEL=claude-opus-4-6
<span class="kw">export</span> CLAUDE_CODE_EFFORT_LEVEL=high

count=0
total_cost=0
log() { local m="[$(date +%H:%M)] WD: $*"; echo "$m"; echo "$m" >> "$LOG"; }

detect_quota() { tail -5 "$LOG" 2>/dev/null | grep -qiE "credit|quota|429|billing"; }

check_budget() {
  total_cost=$((total_cost + SESSION_COST_EST))
  log "COST: session ~\$${SESSION_COST_EST} ‚Äî TOTAL: ~\$${total_cost}/\$${MAX_COST}"
  if [ "$total_cost" -ge "$MAX_COST" ]; then
    log "BUDGET EXCEEDED \$${total_cost} >= \$${MAX_COST} ‚Äî stopping"
    echo "Budget exceeded: \$${total_cost} of \$${MAX_COST}" > "$WORKDIR/BUDGET_EXCEEDED"
    exit 1
  fi
  if [ "$total_cost" -ge "$ALERT_COST" ]; then
    log "BUDGET ALERT: \$${total_cost} of \$${MAX_COST} used"
  fi
}

check_stall() {
  local last_commit_time
  last_commit_time=$(git -C "$WORKDIR" log -1 --format="%ct" 2>/dev/null || echo 0)
  local now; now=$(date +%s)
  local elapsed=$(( now - last_commit_time ))
  if [ "$elapsed" -gt "$STALL_TIMEOUT" ]; then
    log "STALL DETECTED: no commit in ${elapsed}s ‚Äî forcing restart"
    return 1
  fi
  return 0
}

<span class="cm"># v5: Thrashing detection ‚Äî nhi·ªÅu commits nh∆∞ng 0 features pass</span>
check_thrashing() {
  local recent_commits=$(git -C "$WORKDIR" log --since="30 minutes ago" --oneline 2>/dev/null | wc -l)
  local current_passes=$(jq '[.[]|select(.passes==true)]|length' "$WORKDIR/feature_list.json" 2>/dev/null || echo 0)
  local prev_passes=$(cat "$WORKDIR/.thrash_check" 2>/dev/null || echo 0)
  local new_passes=$((current_passes - prev_passes))
  echo "$current_passes" > "$WORKDIR/.thrash_check"

  if [ "$recent_commits" -gt 10 ] && [ "$new_passes" -eq 0 ]; then
    log "THRASHING: $recent_commits commits in 30min, 0 new features passed ‚Äî fresh restart"
    return 1
  fi
  return 0
}

<span class="cm"># v5: Save state snapshot before restart</span>
save_state_snapshot() {
  local feature_id=$(jq -r '[.[]|select(.passes==false and .blocked==false)][0].id // "none"' \
    "$WORKDIR/feature_list.json" 2>/dev/null)
  local last_error=$(tail -3 "$LOG" 2>/dev/null | grep -i "error\|fail" | tail -1)
  cat > "$WORKDIR/.last_state.json" << SNAPSHOT
{"current_feature_id":$feature_id,"last_error":"$(echo "$last_error" | tr '"' "'")","timestamp":"$(date -Iseconds)","session_number":$count}
SNAPSHOT
}

rotate_log() {
  local lines; lines=$(wc -l < "$LOG" 2>/dev/null || echo 0)
  if [ "$lines" -gt 500 ]; then
    mkdir -p "$WORKDIR/logs"
    mv "$LOG" "$WORKDIR/logs/LIVE_LOG_$(date +%Y%m%d_%H%M%S).md"
    echo "# LIVE_LOG.md ‚Äî rotated $(date)" > "$LOG"
    log "Log rotated (was ${lines} lines)"
  fi
}

cd "$WORKDIR" || exit 1
log "AEGIS v5 Watchdog started ‚Äî budget \$${MAX_COST} ‚Äî opus-4-6/high"

while [ "$count" -lt "$MAX_RESTARTS" ]; do
  [ -f "$WORKDIR/PAUSE" ] && { log "PAUSED ‚Äî remove PAUSE file to resume"; sleep 60; continue; }
  [ -f "$WORKDIR/BUDGET_EXCEEDED" ] && { log "Budget exceeded ‚Äî stopped"; exit 1; }

  rotate_log
  <span class="cm"># v5: Check thrashing before launch</span>
  THRASHING=false
  check_thrashing || THRASHING=true

  log "Launch #$((count + 1)) of $MAX_RESTARTS"
  <span class="cm"># v5: Save state snapshot before each session</span>
  save_state_snapshot

  if [ "$THRASHING" = true ]; then
    <span class="cm"># v5: Thrashing ‚Üí skip --continue, go straight to fresh with explicit instructions</span>
    log "Thrashing detected ‚Äî fresh start (skipping --continue)"
    claude --model claude-opus-4-6 --dangerously-skip-permissions \
      -p "ƒê·ªçc AEGIS.md. B·∫°n l√† CODING AGENT. C·∫¢NH B√ÅO: session tr∆∞·ªõc b·ªã thrashing.
ƒê·ªçc .last_state.json ƒë·ªÉ hi·ªÉu context. Ch·ªçn approach KH√ÅC cho feature hi·ªán t·∫°i.
N·∫øu feature qu√° kh√≥ ‚Üí mark blocked, skip sang feature kh√°c."
    EC=$?
  else
    <span class="cm"># Normal: th·ª≠ --continue tr∆∞·ªõc</span>
    <span class="cm"># v5: --continue v·ªõi timeout validation</span>
    LAST_COMMIT_BEFORE=$(git -C "$WORKDIR" log -1 --format="%ct" 2>/dev/null || echo 0)
    claude --model claude-opus-4-6 --dangerously-skip-permissions --continue 2>/dev/null &
    CLAUDE_PID=$!

    <span class="cm"># v5: Monitor --continue session for CONTINUE_TIMEOUT</span>
    CONTINUE_START=$(date +%s)
    while kill -0 "$CLAUDE_PID" 2>/dev/null; do
      sleep 30
      ELAPSED=$(( $(date +%s) - CONTINUE_START ))
      LAST_COMMIT_NOW=$(git -C "$WORKDIR" log -1 --format="%ct" 2>/dev/null || echo 0)
      if [ "$ELAPSED" -gt "$CONTINUE_TIMEOUT" ] && [ "$LAST_COMMIT_NOW" -le "$LAST_COMMIT_BEFORE" ]; then
        log "--continue stale after ${ELAPSED}s with no new commits ‚Äî killing"
        kill "$CLAUDE_PID" 2>/dev/null
        wait "$CLAUDE_PID" 2>/dev/null
        break
      fi
    done
    wait "$CLAUDE_PID" 2>/dev/null
    EC=$?

    if [ "$EC" -ne 0 ]; then
      claude --model claude-opus-4-6 --dangerously-skip-permissions \
        -p "ƒê·ªçc AEGIS.md. B·∫°n l√† CODING AGENT. ƒê·ªçc .last_state.json n·∫øu c√≥. Ti·∫øp t·ª•c coding t·ª´ feature ch∆∞a ho√†n th√†nh."
      EC=$?
    fi
  fi

  count=$((count + 1))
  check_budget

  [ "$EC" -eq 0 ] && { log "Session ended normally"; check_stall || continue; exit 0; }

  if detect_quota; then
    log "Quota hit ‚Äî waiting ${CREDIT_WAIT}s"
    sleep "$CREDIT_WAIT"
  else
    log "Session crashed (exit=$EC) ‚Äî waiting ${RESTART_DELAY}s"
    sleep "$RESTART_DELAY"
  fi
done
log "Max restarts reached ‚Äî manual intervention needed"
exit 1</pre>

      <pre><span class="label">terminal ‚Äî kh·ªüi ƒë·ªông watchdog</span>
<span class="kw">chmod</span> +x scripts/agent-watchdog.sh
tmux new-session -d -s agent <span class="st">'bash scripts/agent-watchdog.sh'</span>
echo <span class="st">"Agent running. Monitor: tmux attach -t agent"</span></pre>

    </div>

    <!-- Step 02b ‚Äî Existing Codebase Mode -->
    <div class="step">
      <div class="step-head">
        <span class="step-num" style="background:var(--violet);color:#000">02b</span>
        <span class="step-title">Existing Codebase Mode ‚Äî Scan tr∆∞·ªõc, plan sau</span>
      </div>

      <p>Khi drop AEGIS v√†o project ƒë√£ c√≥ s·∫µn, Bootstrap agent th·ª±c hi·ªán <strong>Codebase Exploration</strong> tr∆∞·ªõc khi t·∫°o b·∫•t k·ª≥ file n√†o.</p>

      <h3>Nh·ªØng g√¨ Bootstrap l√†m (existing mode)</h3>

      <pre><span class="label">Bootstrap Phase 0 ‚Äî existing codebase flow</span>
<span class="cm"># 1. Auto-detect: existing n·∫øu c√≥ src/, .env, node_modules, ho·∫∑c git history</span>
find . -not -path '*/node_modules/*' -not -path '*/.git/*' -type f | head -50

<span class="cm"># 2. ƒê·ªçc package.json / requirements.txt / go.mod</span>
<span class="cm"># 3. ƒê·ªçc .env ‚Äî ch·ªâ l·∫•y KEY names, kh√¥ng log values</span>
<span class="cm"># 4. ƒê·ªçc entry points: index.ts, app.ts, server.ts, pages/_app.*</span>
<span class="cm"># 5. ƒê·ªçc t·ªëi ƒëa 10 core files (routes, models, services)</span>
<span class="cm"># 6. git log --oneline -20 ‚Üí hi·ªÉu ti·∫øn ƒë·ªô</span>

<span class="cm"># ‚Üí T·∫°o CODEBASE_SCAN.md v·ªõi k·∫øt qu·∫£</span></pre>

      <pre><span class="label">CODEBASE_SCAN.md ‚Äî AI t·ª± t·∫°o</span>
## Existing Codebase Analysis

### Tech Stack Detected
Framework: Next.js 14 (App Router)
Language: TypeScript
Database: Supabase (PostgreSQL)
Auth: NextAuth.js v5
Styling: Tailwind CSS

### Existing Features (s·∫Ω KH√îNG t·∫°o l·∫°i)
- User authentication (login/register/logout) ‚úì
- Dashboard layout + sidebar ‚úì
- Product listing page ‚úì

### ENV Status
Present: DATABASE_URL, NEXTAUTH_SECRET, NEXTAUTH_URL
Missing: STRIPE_SECRET_KEY, RESEND_API_KEY

### Key Observations
- D√πng server actions (kh√¥ng c√≥ API routes ri√™ng)
- Prisma ORM v·ªõi schema t·∫°i prisma/schema.prisma
- Test: Vitest + Testing Library</pre>

      <div class="note ok">
        <b>NEEDS.md trong existing mode</b> ch·ªâ li·ªát k√™ keys th·ª±c s·ª± c√≤n thi·∫øu. Keys ƒë√£ c√≥ trong <code>.env</code> ƒë∆∞·ª£c ƒë√°nh d·∫•u <code>[x]</code> ngay ‚Äî AI kh√¥ng h·ªèi l·∫°i.
      </div>

      <h3>init.sh ‚Äî validate thay v√¨ overwrite</h3>

      <pre><span class="label">init.sh ‚Äî existing mode: ki·ªÉm tra .env thay v√¨ t·∫°o m·ªõi</span>
<span class="cm"># .env ƒë√£ c√≥ ‚Üí validate keys c√≤n thi·∫øu, KH√îNG overwrite</span>
<span class="kw">if</span> [ -f .env ]; <span class="kw">then</span>
  MISSING=""
  <span class="kw">while</span> IFS= read -r line; <span class="kw">do</span>
    key=$(echo "$line" | grep -oP '^[A-Z_]+(?==)' || true)
    [ -z "$key" ] &amp;&amp; continue
    grep -q "^${key}=.\+" .env || MISSING="$MISSING $key"
  <span class="kw">done</span> &lt; .env.example
  [ -n "$MISSING" ] &amp;&amp; echo "WARNING: Missing keys:$MISSING"
<span class="kw">fi</span></pre>
    </div>

    <!-- Step 03 ‚Äî NEEDS.md -->
    <div class="step">
      <div class="step-head">
        <span class="step-num c">03</span>
        <span class="step-title">NEEDS.md ‚Äî AI h·ªèi, b·∫°n tr·∫£ l·ªùi khi n√†o ti·ªán</span>
      </div>

      <p>Sau Phase 0, AI t·∫°o <code>NEEDS.md</code> li·ªát k√™ m·ªçi th·ª© c·∫ßn t·ª´ b·∫°n. AI code v·ªõi mock data tr∆∞·ªõc, kh√¥ng ch·ªù.
      </p>

      <pre><span class="label">NEEDS.md ‚Äî AI t·ª± t·∫°o, b·∫°n ch·ªâ ƒëi·ªÅn</span>
<span class="cm"># C·∫ßn t·ª´ b·∫°n (tr·∫£ l·ªùi khi n√†o ti·ªán. AI kh√¥ng ch·ªù ‚Äî code v·ªõi mock tr∆∞·ªõc.)</span>
<span class="cm"># Khi ƒëi·ªÅn xong: echo "add-env KEY value" >> STEERING.md</span>

<span class="cm">## B·∫Øt bu·ªôc ƒë·ªÉ deploy</span>
- [ ] VERCEL_TOKEN ‚Äî https://vercel.com/account/tokens
- [ ] GITHUB_TOKEN ‚Äî github.com/settings/tokens (scope: repo, workflow)

<span class="cm">## B·∫Øt bu·ªôc ƒë·ªÉ ch·∫°y backend</span>
- [ ] CLOUDFLARE_API_TOKEN ‚Äî dash.cloudflare.com/profile/api-tokens
- [ ] CLOUDFLARE_ACCOUNT_ID ‚Äî Dashboard ‚Üí Account Home ‚Üí b√™n ph·∫£i

<span class="cm">## Optional (mock n·∫øu ch∆∞a c√≥)</span>
- [ ] SUPABASE_URL + SUPABASE_ANON_KEY ‚Äî app.supabase.com ‚Üí Settings ‚Üí API
- [ ] Custom domain

<span class="cm">---</span>
<span class="cm">## C√°ch cung c·∫•p (t·ª´ SSH/phone)</span>
<span class="cm"># C√°ch 1: Th√™m tr·ª±c ti·∫øp v√†o .env</span>
<span class="cm"># echo "VERCEL_TOKEN=xxx" >> .env</span>
<span class="cm"># C√°ch 2: Qua STEERING.md (AI t·ª± th√™m v√†o .env)</span>
<span class="cm"># echo "add-env VERCEL_TOKEN xxx" >> STEERING.md</span></pre>
    </div>

    <!-- Step 04 ‚Äî Steering -->
    <div class="step">
      <div class="step-head">
        <span class="step-num v">04</span>
        <span class="step-title">Steering ‚Äî ƒêi·ªÅu khi·ªÉn t·ª´ phone</span>
      </div>

      <p>M·ªçi ƒëi·ªÅu khi·ªÉn qua <code>STEERING.md</code>. Agent ƒë·ªçc <strong>atomic</strong> (rename ‚Üí process ‚Üí delete) sau
        m·ªói feature ‚Äî kh√¥ng bao gi·ªù m·∫•t data d√π b·∫°n ƒëang vi·∫øt c√πng l√∫c.</p>

      <h3>Quick Commands</h3>

      <div class="steer-grid">
        <div class="steer-card">
          <div class="icon">üî¥</div>
          <div class="cmd">fix [m√¥ t·∫£ bug]</div>
          <div class="desc">D·ª´ng feature hi·ªán t·∫°i, fix bug n√†y tr∆∞·ªõc</div>
        </div>
        <div class="steer-card">
          <div class="icon">‚è≠Ô∏è</div>
          <div class="cmd">skip [feature/phase]</div>
          <div class="desc">B·ªè qua, l√†m c√°i ti·∫øp theo</div>
        </div>
        <div class="steer-card">
          <div class="icon">üéØ</div>
          <div class="cmd">focus [feature/phase]</div>
          <div class="desc">∆Øu ti√™n l√†m c√°i n√†y tr∆∞·ªõc</div>
        </div>
        <div class="steer-card">
          <div class="icon">‚ûï</div>
          <div class="cmd">add [t√≠nh nƒÉng m·ªõi]</div>
          <div class="desc">Th√™m v√†o feature_list v·ªõi priority cao</div>
        </div>
        <div class="steer-card">
          <div class="icon">üîÑ</div>
          <div class="cmd">change [thay ƒë·ªïi g√¨]</div>
          <div class="desc">Thay ƒë·ªïi approach / tech / design</div>
        </div>
        <div class="steer-card">
          <div class="icon">üöÄ</div>
          <div class="cmd">deploy</div>
          <div class="desc">Deploy ngay phi√™n b·∫£n hi·ªán t·∫°i</div>
        </div>
        <div class="steer-card">
          <div class="icon">üîë</div>
          <div class="cmd">add-env KEY value</div>
          <div class="desc">Th√™m credential v√†o .env</div>
        </div>
        <div class="steer-card">
          <div class="icon">üìä</div>
          <div class="cmd">status</div>
          <div class="desc">In progress report v√†o PROGRESS.md</div>
        </div>
        <div class="steer-card">
          <div class="icon">üîì</div>
          <div class="cmd">unblock #ID</div>
          <div class="desc">Reset retry_count=0 cho feature b·ªã blocked</div>
        </div>
        <div class="steer-card">
          <div class="icon">‚è∏Ô∏è</div>
          <div class="cmd">pause</div>
          <div class="desc">D·ª´ng watchdog sau session hi·ªán t·∫°i</div>
        </div>
      </div>

      <h3>V√≠ d·ª• t·ª´ phone (SSH)</h3>

      <pre><span class="label">Termius / SSH</span>
<span class="cm"># Xem agent ƒëang l√†m g√¨</span>
tail -10 LIVE_LOG.md

<span class="cm"># Bug g·∫•p</span>
echo <span class="st">"fix trang checkout b·ªã l·ªói tr√™n Safari mobile"</span> >> STEERING.md

<span class="cm"># Unblock feature b·ªã stuck</span>
echo <span class="st">"unblock #7"</span> >> STEERING.md

<span class="cm"># Cung c·∫•p credential</span>
echo <span class="st">"add-env VERCEL_TOKEN vel_abc123xyz"</span> >> STEERING.md

<span class="cm"># T·∫°m d·ª´ng ƒë·ªÉ review</span>
echo <span class="st">"pause"</span> >> STEERING.md

<span class="cm"># Vi·∫øt d√†i c≈©ng OK</span>
cat >> STEERING.md << 'EOF'
T√¥i v·ª´a test tr√™n phone, th·∫•y 2 v·∫•n ƒë·ªÅ:
1. Menu hamburger kh√¥ng ƒë√≥ng khi tap outside
2. H√¨nh s·∫£n ph·∫©m b·ªã stretch tr√™n iPhone SE
∆Øu ti√™n fix 2 c√°i n√†y tr∆∞·ªõc khi l√†m t√≠nh nƒÉng m·ªõi.
EOF</pre>

      <div class="note info">
        <b>Atomic read:</b> Agent d√πng <code>mv STEERING.md STEERING.processing.md</code> tr∆∞·ªõc khi ƒë·ªçc. N·∫øu b·∫°n ƒëang
        vi·∫øt v√†o STEERING.md ƒë√∫ng l√∫c agent ƒë·ªçc, data c·ªßa b·∫°n an to√†n ‚Äî agent ch·ªâ x·ª≠ l√Ω file ƒë√£ ƒë∆∞·ª£c rename, STEERING.md
        m·ªõi c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c ƒë·ªçc ·ªü l·∫ßn ti·∫øp theo.
      </div>
    </div>

    <!-- Step 05 ‚Äî Loop Detection -->
    <div class="step">
      <div class="step-head">
        <span class="step-num r">05</span>
        <span class="step-title">Loop Detection + Checkpoint/Rollback</span>
      </div>

      <p>M·ªói feature c√≥ <code>retry_count</code> + <code>depends_on</code>. Agent kh√¥ng bao gi·ªù b·ªã k·∫πt ‚Äî v5 th√™m <strong>checkpoint/rollback</strong> t·ª± ƒë·ªông khi blocked.</p>

      <pre><span class="label">feature_list.json ‚Äî schema v5.1</span>
[{
  "id": 7,
  "phase": 2,
  "priority": 1,
  "category": "payment",
  "description": "Stripe checkout integration",
  <span class="fn">"depends_on": [3, 5],</span>   <span class="cm">‚Üê v5: dependency graph (IDs of required features)</span>
  <span class="fn">"supervision_level": "supervised",</span>  <span class="cm">‚Üê v5.1: "auto" (default) | "supervised" (pause before commit)</span>
  "acceptance_criteria": [
    "User can enter card details",
    "Successful payment redirects to /success",
    "Failed payment shows error message"
  ],
  "steps": ["Navigate to /checkout", "Fill card form", "Submit", "Verify redirect"],
  "passes": false,
  "retry_count": 0,               <span class="cm">‚Üê tƒÉng sau m·ªói l·∫ßn fail</span>
  "blocked": false,                <span class="cm">‚Üê true khi retry_count >= 3 (+ auto-rollback)</span>
  "completed_at": null
}]</pre>

      <div class="note info">
        <b>supervision_level:</b> <code>"auto"</code> (default) = agent t·ª± code v√† commit. <code>"supervised"</code> = agent code xong, d·ª´ng l·∫°i, ghi v√†o NEEDS.md ch·ªù b·∫°n approve. D√πng <code>"supervised"</code> cho: payment flows, security-critical code, core business logic. Approve qua: <code>echo "approve #7" >> STEERING.md</code>
      </div>

      <h3>Flow khi feature b·ªã stuck</h3>

      <pre><span class="label">agent behavior ‚Äî v5: checkpoint + rollback</span>
<span class="cm"># Before starting feature:</span>
git tag "checkpoint/pre-feature-7" HEAD     <span class="cm">‚Üê v5: save checkpoint</span>

Feature #7: Stripe checkout
  ‚Üí Attempt 1: build fail (missing env var) ‚Üí retry_count=1
  ‚Üí Attempt 2: test fail (webhook signature) ‚Üí retry_count=2
  ‚Üí Attempt 3: test fail (same error)       ‚Üí retry_count=3

retry_count >= 3:
  ‚Üí feature.blocked = true
  ‚Üí <span class="fn">git reset --hard "checkpoint/pre-feature-7"</span>  <span class="cm">‚Üê v5: auto-rollback!</span>
  ‚Üí append BLOCKED.md:
     "[14:32] Feature #7 blocked after 3 retries
      Error: Stripe webhook signature mismatch
      Tried: mock webhook, test mode, env var fix
      Needs: STRIPE_WEBHOOK_SECRET from user
      Rolled back to checkpoint/pre-feature-7"
  ‚Üí append NEEDS.md: "- [ ] STRIPE_WEBHOOK_SECRET"
  ‚Üí continue to feature #8 <span class="cm">(code is clean ‚Äî no broken artifacts)</span>

<span class="cm"># When feature passes:</span>
git tag -d "checkpoint/pre-feature-7"       <span class="cm">‚Üê cleanup checkpoint</span></pre>

      <h3>Unblock t·ª´ phone</h3>

      <pre><span class="label">SSH</span>
<span class="cm"># Xem features b·ªã blocked</span>
cat BLOCKED.md

<span class="cm"># Cung c·∫•p secret c√≤n thi·∫øu</span>
echo <span class="st">"add-env STRIPE_WEBHOOK_SECRET whsec_xxx"</span> >> STEERING.md

<span class="cm"># Unblock feature ƒë·ªÉ agent th·ª≠ l·∫°i</span>
echo <span class="st">"unblock #7"</span> >> STEERING.md</pre>

      <div class="note warn">
        <b>Watchdog stall + thrashing detection (v5):</b> Stall: kh√¥ng commit trong 40 ph√∫t ‚Üí restart. Thrashing (v5): >10 commits trong 30 ph√∫t nh∆∞ng 0 features pass ‚Üí force fresh restart (skip --continue) v·ªõi c·∫£nh b√°o ch·ªçn approach kh√°c. C·∫£ hai level ƒë∆∞·ª£c monitor ƒë·ªìng th·ªùi.
      </div>
    </div>

    <!-- Step 06 ‚Äî Monitoring -->
    <div class="step">
      <div class="step-head">
        <span class="step-num b">06</span>
        <span class="step-title">Monitoring & Health Check</span>
      </div>

      <pre><span class="label">scripts/health-check.sh ‚Äî v5: checkpoints + dependencies + state</span>
#!/usr/bin/env bash
W="$(cd "$(dirname "$0")/.." && pwd)"; cd "$W"
echo "‚ïê‚ïê‚ïê AEGIS v5 Status ‚ïê‚ïê‚ïê"
echo

if [ -f feature_list.json ]; then
  T=$(jq length feature_list.json)
  D=$(jq '[.[]|select(.passes==true)]|length' feature_list.json)
  B=$(jq '[.[]|select(.blocked==true)]|length' feature_list.json)
  P=$((T > 0 ? D * 100 / T : 0))
  echo "Progress: $D/$T features ($P%) | Blocked: $B"
  echo "Phase breakdown:"
  jq -r 'group_by(.phase)|.[]|
    "  Phase \(.[0].phase): \([.[]|select(.passes==true)]|length)/\(length) done, \([.[]|select(.blocked==true)]|length) blocked"' \
    feature_list.json

  <span class="cm"># v5: Show features blocked by dependencies</span>
  DEP_BLOCKED=$(jq '[
    . as $all |
    .[] | select(.passes==false and .blocked==false) |
    select(.depends_on | length > 0) |
    select(.depends_on | any(. as $d | $all[] | select(.id == $d and .passes == false)) )
  ] | length' feature_list.json 2>/dev/null || echo 0)
  [ "$DEP_BLOCKED" -gt 0 ] && echo "  Waiting on dependencies: $DEP_BLOCKED features"
fi

echo
echo "Recent log:"
tail -5 LIVE_LOG.md 2>/dev/null || echo "  (no log)"

echo
<span class="cm"># v5: Active checkpoints</span>
echo "Checkpoints:"
CKPTS=$(git tag -l "checkpoint/*" 2>/dev/null | wc -l)
echo "  $CKPTS active checkpoint tags"

echo
<span class="cm"># v5: Last state snapshot</span>
echo "Last state:"
[ -f .last_state.json ] && cat .last_state.json | jq -r '"  Feature #\(.current_feature_id) | Session \(.session_number) | \(.timestamp)"' 2>/dev/null || echo "  (no snapshot)"

echo
echo "Budget:"
[ -f COST_TRACKER.md ] && tail -3 COST_TRACKER.md || echo "  No cost data yet"
[ -f BUDGET_EXCEEDED ] && echo "  !! BUDGET EXCEEDED ‚Äî remove BUDGET_EXCEEDED to resume"

echo
echo "Blockers:"
[ -s BLOCKED.md ] && grep "^##" BLOCKED.md | head -5 || echo "  None"

echo
echo "Steering:"
[ -s STEERING.md ] && cat STEERING.md || echo "  Empty"
[ -f STEERING.processing.md ] && echo "  (processing...)"

echo
echo "Agent:"
tmux has-session -t agent 2>/dev/null && echo "  Running" || echo "  NOT running"
echo "  Last commit: $(git log --oneline -1 2>/dev/null)"
echo "  Last commit time: $(git log -1 --format='%ar' 2>/dev/null)"</pre>

      <h3>Cheat Sheet t·ª´ phone</h3>

      <table>
        <thead>
          <tr>
            <th>Mu·ªën</th>
            <th>G√µ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Xem agent</td>
            <td><code>tmux attach -t agent</code> (tho√°t: Ctrl+B, D)</td>
          </tr>
          <tr>
            <td>Quick status</td>
            <td><code>bash scripts/health-check.sh</code></td>
          </tr>
          <tr>
            <td>Log g·∫ßn nh·∫•t</td>
            <td><code>tail -20 LIVE_LOG.md</code></td>
          </tr>
          <tr>
            <td>Features blocked</td>
            <td><code>jq '[.[]|select(.blocked)]' feature_list.json</code></td>
          </tr>
          <tr>
            <td>Budget status</td>
            <td><code>cat COST_TRACKER.md</code></td>
          </tr>
          <tr>
            <td>Steer</td>
            <td><code>echo "fix XYZ" >> STEERING.md</code></td>
          </tr>
          <tr>
            <td>Th√™m credential</td>
            <td><code>echo "add-env KEY val" >> STEERING.md</code></td>
          </tr>
          <tr>
            <td>T·∫°m d·ª´ng</td>
            <td><code>echo "pause" >> STEERING.md</code></td>
          </tr>
          <tr>
            <td>Resume sau pause</td>
            <td><code>rm PAUSE && tmux new-session -d -s agent 'bash scripts/agent-watchdog.sh'</code></td>
          </tr>
          <tr>
            <td>Emergency restart</td>
            <td><code>tmux kill-session -t agent && bash scripts/agent-watchdog.sh</code></td>
          </tr>
          <tr>
            <td>Hard reset</td>
            <td><code>git reset --hard [hash]</code></td>
          </tr>
          <tr>
            <td>Checkpoints (v5)</td>
            <td><code>git tag -l "checkpoint/*"</code></td>
          </tr>
          <tr>
            <td>Last state (v5)</td>
            <td><code>cat .last_state.json | jq .</code></td>
          </tr>
          <tr>
            <td>Dependencies (v5)</td>
            <td><code>jq '.[]|select(.depends_on|length>0)|{id,depends_on}' feature_list.json</code></td>
          </tr>
          <tr>
            <td>Quick status (slash cmd)</td>
            <td><code>/status</code> ‚Äî trong Claude Code session</td>
          </tr>
          <tr>
            <td>Unblock (slash cmd)</td>
            <td><code>/unblock 7</code> ‚Äî reset feature #7 ƒë·ªÉ retry</td>
          </tr>
          <tr>
            <td>Rollback (slash cmd)</td>
            <td><code>/rollback 7</code> ‚Äî git reset v·ªÅ checkpoint feature #7</td>
          </tr>
          <tr>
            <td>Approve supervised</td>
            <td><code>echo "approve #7" >> STEERING.md</code></td>
          </tr>
        </tbody>
      </table>

      <h3>Auto-recovery table</h3>

      <table>
        <thead>
          <tr>
            <th>S·ª± c·ªë</th>
            <th>Watchdog l√†m</th>
            <th>B·∫°n c·∫ßn l√†m</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>API crash / 502</td>
            <td>Ch·ªù 45s ‚Üí restart v·ªõi --continue</td>
            <td>Kh√¥ng c·∫ßn</td>
          </tr>
          <tr>
            <td>H·∫øt credit / 429</td>
            <td>Ch·ªù 15 ph√∫t ‚Üí retry</td>
            <td>N·∫°p credit n·∫øu mu·ªën nhanh</td>
          </tr>
          <tr>
            <td>Feature b·ªã loop</td>
            <td>retry_count >= 3 ‚Üí auto-rollback + skip</td>
            <td>Xem BLOCKED.md, unblock khi c√≥ info</td>
          </tr>
          <tr>
            <td>Session stall 40 ph√∫t</td>
            <td>Force restart</td>
            <td>Kh√¥ng c·∫ßn</td>
          </tr>
          <tr>
            <td>Thrashing (v5)</td>
            <td>>10 commits, 0 pass ‚Üí fresh restart</td>
            <td>Kh√¥ng c·∫ßn (auto ch·ªçn approach kh√°c)</td>
          </tr>
          <tr>
            <td>Worker dead (v5)</td>
            <td>Heartbeat > 5min ‚Üí auto-respawn</td>
            <td>Kh√¥ng c·∫ßn</td>
          </tr>
          <tr>
            <td>Budget exceeded</td>
            <td>T·∫°o BUDGET_EXCEEDED, d·ª´ng</td>
            <td><code>rm BUDGET_EXCEEDED</code> ho·∫∑c tƒÉng MAX_COST_USD</td>
          </tr>
          <tr>
            <td>User mu·ªën pause</td>
            <td>D·ª´ng sau session hi·ªán t·∫°i</td>
            <td><code>echo "pause" >> STEERING.md</code></td>
          </tr>
          <tr>
            <td>Code h·ªèng n·∫∑ng</td>
            <td>‚Äî</td>
            <td><code>git reset --hard [hash]</code> ‚Üí restart</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Step 07 ‚Äî Multi-Agent Parallel -->
    <div class="step">
      <div class="step-head">
        <span class="step-num g">07</span>
        <span class="step-title">Multi-Agent Parallel ‚Äî Ch·∫°y song song nhi·ªÅu agent</span>
      </div>

      <p>Khi project ƒë·ªß l·ªõn (‚â•20 features pending), AEGIS t·ª± chuy·ªÉn sang multi-agent mode: 1 orchestrator ph√¢n task + N
        workers code song song trong git worktrees ri√™ng.</p>

      <div class="note info">
        <b>Config trong AEGIS.md:</b> <code>EXECUTION_MODE: auto | single | multi</code>, <code>MAX_WORKERS: 3</code>,
        <code>MIN_FEATURES_FOR_MULTI: 20</code>. M·∫∑c ƒë·ªãnh <code>auto</code> ‚Äî t·ª± chuy·ªÉn khi ƒë·ªß features.
      </div>

      <h3>Ki·∫øn tr√∫c</h3>

      <div class="tree">
        <span class="h">Orchestrator Agent</span> <span class="dim">(tmux pane 0 ‚Äî root project dir)</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">Worker 1</span> <span class="dim">(tmux pane 1 ‚Äî .worktrees/worker-1 ‚Äî branch:
          worker-1)</span><br>
        ‚îú‚îÄ‚îÄ <span class="new">Worker 2</span> <span class="dim">(tmux pane 2 ‚Äî .worktrees/worker-2 ‚Äî branch:
          worker-2)</span><br>
        ‚îî‚îÄ‚îÄ <span class="new">Worker 3</span> <span class="dim">(tmux pane 3 ‚Äî .worktrees/worker-3 ‚Äî branch:
          worker-3)</span>
      </div>

      <h3>Orchestrator (kh√¥ng code ‚Äî ch·ªâ qu·∫£n l√Ω)</h3>

      <pre><span class="label">orchestrator flow ‚Äî v5: dependency-aware + heartbeat</span>
<span class="cm"># 1. Topological sort features theo depends_on (v5)</span>
<span class="cm">#    Wave 1: depends_on=[] ‚Üí worker-1: auth, worker-2: api, worker-3: ui</span>
<span class="cm">#    Wave 2: depends on wave 1 ‚Üí assigned after wave 1 merge</span>

<span class="cm"># 2. T·∫°o worktrees + assign features (ch·ªâ wave 1 features)</span>
git worktree add .worktrees/worker-1 -b worker-1 dev
git worktree add .worktrees/worker-2 -b worker-2 dev

<span class="cm"># 3. T·∫°o WORKER_ID (v5: includes WAVE number)</span>
cat > .worktrees/worker-1/WORKER_ID << 'EOF'
WORKER_NUM=1
BRANCH=worker-1
ASSIGNED_FEATURES=[3,4,7]
CATEGORY=auth
WAVE=1
EOF

<span class="cm"># 4. Spawn workers trong tmux panes</span>
<span class="cm"># 5. Monitor progress (poll m·ªói 2 ph√∫t ‚Äî v5: heartbeat check)</span>
<span class="cm">#    If worker HEARTBEAT file > 5 min old ‚Üí respawn worker</span>
<span class="cm"># 6. Wave merge khi workers xong:</span>
git checkout dev
git merge worker-1 --no-edit
<span class="cm"># v5: build+test after EACH merge (catch conflicts early)</span>
npm run build && npm test
git merge worker-2 --no-edit
npm run build && npm test
git merge worker-3 --no-edit

<span class="cm"># 7. Full integration test after all merges (v5)</span>
<span class="cm"># 8. If wave 2 features exist ‚Üí repeat from step 2</span>
<span class="cm"># 9. Cleanup: remove worktrees + delete worker branches</span></pre>

      <h3>Worker Agent (ch·ªâ code features ƒë∆∞·ª£c assign)</h3>

      <pre><span class="label">worker flow ‚Äî v5: heartbeat + checkpoint + depends_on</span>
<span class="cm"># Worker ƒë·ªçc WORKER_ID ‚Üí bi·∫øt features c·∫ßn l√†m</span>
<span class="cm"># v5: Start heartbeat background process</span>
while true; do date +%s > HEARTBEAT; sleep 60; done &

<span class="cm"># Worker tu√¢n theo:</span>
1. ƒê·ªçc WORKER_ID ‚Üí l·∫•y assigned features
2. ƒê·ªçc BLUEPRINT.md ‚Üí hi·ªÉu architecture
3. <span class="fn">Respect depends_on order</span> (v5): ch·ªâ code khi dependencies passed
4. <span class="fn">Checkpoint tr∆∞·ªõc m·ªói feature</span> (v5): git tag checkpoint/...
5. Code feature ‚Üí test ‚Üí commit v√†o branch worker-N
6. <span class="fn">N·∫øu blocked ‚Üí rollback checkpoint</span> (v5): code s·∫°ch
7. <span class="fn">KH√îNG</span> ƒë·ªçc/ghi STEERING.md (ch·ªâ orchestrator ƒë·ªçc)
8. <span class="fn">KH√îNG</span> merge v√†o dev (orchestrator l√†m)
9. <span class="fn">KH√îNG</span> s·ª≠a files ngo√†i scope assigned
10. Khi xong t·∫•t c·∫£ features ‚Üí exit session
11. Ghi progress v√†o WORKER_LOG.md trong worktree</pre>

      <h3>Feature Assignment Strategy (v5: dependency-aware)</h3>

      <table>
        <thead>
          <tr>
            <th>Nguy√™n t·∫Øc</th>
            <th>V√≠ d·ª•</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Topological sort (v5)</td>
            <td><code>depends_on:[]</code> ‚Üí wave 1; depends wave 1 ‚Üí wave 2</td>
          </tr>
          <tr>
            <td>Group by category</td>
            <td>Auth features ‚Üí worker-1, Dashboard ‚Üí worker-2</td>
          </tr>
          <tr>
            <td>Chain optimization (v5)</td>
            <td>A‚ÜíB‚ÜíC c√πng category ‚Üí c√πng worker (skip wave overhead)</td>
          </tr>
          <tr>
            <td>Load balancing</td>
            <td>15 features √∑ 3 workers = ~5 features/worker</td>
          </tr>
          <tr>
            <td>Independent first</td>
            <td>Features <code>depends_on:[]</code> ‚Üí wave 1 song song</td>
          </tr>
        </tbody>
      </table>

      <h3>Khi n√†o d√πng Single vs Multi</h3>

      <table>
        <thead>
          <tr>
            <th>T√¨nh hu·ªëng</th>
            <th>Mode</th>
            <th>L√Ω do</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Project m·ªõi, Phase 1 (10 features)</td>
            <td><code>single</code></td>
            <td>√çt features, c·∫ßn setup foundation</td>
          </tr>
          <tr>
            <td>Phase 3+ v·ªõi 25 features pending</td>
            <td><code>multi</code></td>
            <td>ƒê·ªß features independent</td>
          </tr>
          <tr>
            <td>Bug fixing (3-5 bugs)</td>
            <td><code>single</code></td>
            <td>Bugs th∆∞·ªùng li√™n quan nhau</td>
          </tr>
          <tr>
            <td>Adding 20 API endpoints</td>
            <td><code>multi</code></td>
            <td>Endpoints independent</td>
          </tr>
          <tr>
            <td>UI components (15 pages)</td>
            <td><code>multi</code></td>
            <td>Pages th∆∞·ªùng independent</td>
          </tr>
        </tbody>
      </table>

      <h3>Chi ph√≠</h3>

      <div class="diff-grid">
        <div class="diff-box old">
          <div class="diff-label">Single Agent</div>
          <ul style="list-style:none">
            <li style="padding:.15rem 0">1 session √ó $9-18</li>
            <li style="padding:.15rem 0"><strong>= $9-18 / batch</strong></li>
          </ul>
        </div>
        <div class="diff-box new">
          <div class="diff-label">Multi Agent (3 workers)</div>
          <ul style="list-style:none">
            <li style="padding:.15rem 0">1 orchestrator + 3 workers</li>
            <li style="padding:.15rem 0"><strong>= ~$36-72 / batch</strong></li>
            <li style="padding:.15rem 0">Nhanh ~2-3x, ƒë·∫Øt ~3-4x</li>
          </ul>
        </div>
      </div>

      <h3>Ch·∫°y multi-agent th·ªß c√¥ng</h3>

      <pre><span class="label">terminal</span>
<span class="cm"># Ch·∫°y v·ªõi 3 workers (m·∫∑c ƒë·ªãnh)</span>
bash scripts/multi-agent.sh

<span class="cm"># Ch·∫°y v·ªõi 5 workers</span>
bash scripts/multi-agent.sh 5

<span class="cm"># Xem workers status</span>
cat WORKERS.md</pre>

      <h3>WORKERS.md ‚Äî Tracking format</h3>

      <pre><span class="label">WORKERS.md</span>
<span class="cm">## Multi-Agent Wave #1 ‚Äî Started 2024-01-15 14:00</span>

| Worker | Branch   | Features        | Status       | Commits |
|--------|----------|-----------------|--------------|--------|
| 1      | worker-1 | #3,#4,#7 (auth) | ‚úÖ Done       | 5      |
| 2      | worker-2 | #5,#6,#8 (dash) | üîÑ Running   | 3      |
| 3      | worker-3 | #9,#10,#11 (api)| ‚ùå Failed #10 | 4      |

<span class="cm">### Merge Status</span>
- [x] worker-1 ‚Üí dev (merged)
- [ ] worker-2 ‚Üí dev (pending)
- [ ] worker-3 ‚Üí dev (pending)
- [ ] Build + test after merge</pre>

      <div class="note warn">
        <b>Conflict resolution (v5):</b> Orchestrator t·ª± resolve conflicts. >50 lines conflict ‚Üí gi·ªØ worker c√≥ nhi·ªÅu changes h∆°n, feature kia retry ·ªü wave ti·∫øp. v5: <code>npm run build && npm test</code> ch·∫°y sau <strong>M·ªñI</strong> worker merge (kh√¥ng ch·ªù merge h·∫øt) ‚Äî b·∫Øt conflict s·ªõm h∆°n.
      </div>

      <h3>Git Strategy ‚Äî Multi-agent mode</h3>

      <pre><span class="label">branch model</span>
main       ‚Üê production (deploy trigger)
dev        ‚Üê merge target / single-agent works here
worker-1   ‚Üê temporary: worker 1 (deleted after merge)
worker-2   ‚Üê temporary: worker 2 (deleted after merge)
worker-3   ‚Üê temporary: worker 3 (deleted after merge)

<span class="cm"># Commit format per worker:</span>
feat: [phase N] #featureID description (worker-N)</pre>

    </div>

    <!-- Step 08 ‚Äî Deploy -->
    <div class="step">
      <div class="step-head">
        <span class="step-num">08</span>
        <span class="step-title">Deploy Pipeline ‚Äî Staging ‚Üí Production (v5)</span>
      </div>

      <div class="note ok">
        <b>v5 Rule:</b> KH√îNG BAO GI·ªú deploy th·∫≥ng production. Flow: deploy staging ‚Üí health check ‚Üí smoke test ‚Üí promote to production. Agent t·ª± x·ª≠ l√Ω flow n√†y.
      </div>

      <h3>Vercel (Frontend) ‚Äî staging first</h3>
      <pre><span class="label">v5 deploy flow</span>
<span class="cm"># Step 1: Deploy staging (kh√¥ng c√≥ --prod)</span>
STAGING_URL=$(npx vercel deploy --token "$VERCEL_TOKEN" --yes 2>&1 | grep -o 'https://[^ ]*')

<span class="cm"># Step 2: Health check</span>
curl -sf "$STAGING_URL/api/health" || { echo "Staging FAIL"; exit 1; }

<span class="cm"># Step 3: Promote to production</span>
npx vercel deploy --prod --token "$VERCEL_TOKEN" --yes</pre>

      <h3>Config examples</h3>
      <pre><span class="label">vercel.json</span>
{
  "buildCommand": "pnpm build",
  "installCommand": "pnpm install --frozen-lockfile",
  "framework": "nextjs",
  "regions": ["sin1"]
}</pre>

      <h3>Cloudflare Workers (API)</h3>
      <pre><span class="label">wrangler.toml</span>
name = "my-api"
main = "src/index.ts"
compatibility_date = "2025-12-01"

[vars]
ENVIRONMENT = "production"

[[d1_databases]]
binding = "DB"
database_name = "my-db"
database_id = ""  <span class="cm"># AI fills after: wrangler d1 create my-db</span>

[[r2_buckets]]
binding = "STORAGE"
bucket_name = "my-storage"</pre>

      <h3>GitHub Actions CI/CD</h3>
      <pre><span class="label">.github/workflows/deploy.yml</span>
name: Deploy
on:
  push:
    branches: [main]
jobs:
  deploy-frontend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v4
      - run: pnpm install --frozen-lockfile
      - run: pnpm build
      - uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod'

  deploy-api:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: cloudflare/wrangler-action@v3
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          workingDirectory: 'apps/api'</pre>
    </div>

    <!-- Step 09 ‚Äî Claude Code Hooks -->
    <div class="step">
      <div class="step-head">
        <span class="step-num v">09</span>
        <span class="step-title">Claude Opus Hooks ‚Äî Quality gates t·ª± ƒë·ªông</span>
      </div>

      <p>Bootstrap t·∫°o <code>.claude/settings.json</code> v·ªõi 2 hooks quan tr·ªçng. Kh√¥ng c·∫ßn c√†i th√™m g√¨ ‚Äî Claude Code ƒë·ªçc t·ª± ƒë·ªông.</p>

      <h3>Stop Hook ‚Äî NgƒÉn agent d·ª´ng khi c√≤n pending features</h3>

      <pre><span class="label">.claude/settings.json ‚Äî auto-created by Bootstrap</span>
{
  "hooks": {
    "Stop": [{
      "hooks": [{
        "type": "prompt",
        "prompt": "Check feature_list.json: are there features with passes=false AND blocked=false? If yes, return {\"ok\": false, \"reason\": \"Still have N pending features\"}. If none, return {\"ok\": true}."
      }]
    }],
    "PostToolUse": [{
      "matcher": "Write|Edit|NotebookEdit",
      "hooks": [{
        "type": "command",
        "command": "bash .claude/hooks/lint-check.sh",
        "async": true
      }]
    }]
  }
}</pre>

      <div class="note ok">
        <b>Stop hook</b> l√† quan tr·ªçng nh·∫•t ‚Äî ngƒÉn agent k·∫øt th√∫c session khi c√≤n features ch∆∞a l√†m. Agent ph·∫£i ti·∫øp t·ª•c cho ƒë·∫øn khi t·∫•t c·∫£ features passes=true ho·∫∑c blocked=true.
      </div>

      <h3>Custom Slash Commands ‚Äî Reusable workflows</h3>

      <p>Bootstrap t·∫°o <code>.claude/commands/</code> v·ªõi 3 commands d√πng ngay trong Claude Code session:</p>

      <div class="steer-grid">
        <div class="steer-card">
          <div class="icon">üìä</div>
          <div class="cmd">/status</div>
          <div class="desc">Ch·∫°y health-check.sh + show LIVE_LOG tail</div>
        </div>
        <div class="steer-card">
          <div class="icon">üîì</div>
          <div class="cmd">/unblock [id]</div>
          <div class="desc">Reset retry_count=0, blocked=false cho feature</div>
        </div>
        <div class="steer-card">
          <div class="icon">‚è™</div>
          <div class="cmd">/rollback [id]</div>
          <div class="desc">git reset --hard v·ªÅ checkpoint/pre-feature-[id]</div>
        </div>
      </div>

      <h3>Hooks kh√¥ng c·∫ßn thi·∫øt cho AEGIS</h3>

      <table>
        <thead>
          <tr>
            <th>Hook</th>
            <th>C·∫ßn?</th>
            <th>L√Ω do</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Stop</code></td>
            <td>‚úì C·∫¶N</td>
            <td>NgƒÉn agent d·ª´ng khi c√≤n pending features</td>
          </tr>
          <tr>
            <td><code>PostToolUse</code> (Write/Edit)</td>
            <td>‚úì C·∫¶N</td>
            <td>Ch·∫°y lint async sau m·ªói file edit</td>
          </tr>
          <tr>
            <td><code>TaskCompleted</code></td>
            <td>Optional</td>
            <td>v5 ƒë√£ c√≥ quality gates trong agent protocol</td>
          </tr>
          <tr>
            <td><code>SessionEnd</code></td>
            <td>Optional</td>
            <td>v5 ƒë√£ c√≥ COST_TRACKER.md</td>
          </tr>
          <tr>
            <td><code>WorktreeCreate/Remove</code></td>
            <td>‚úó Kh√¥ng</td>
            <td>v5 t·ª± qu·∫£n l√Ω worktrees trong multi-agent.sh</td>
          </tr>
          <tr>
            <td><code>TeammateIdle</code></td>
            <td>‚úó Kh√¥ng</td>
            <td>Ch·ªâ c·∫ßn cho Claude Code Teams, kh√¥ng ph·∫£i git worktrees</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Step 10 ‚Äî Semantic Memory -->
    <div class="step">
      <div class="step-head">
        <span class="step-num b">10</span>
        <span class="step-title">Semantic Memory ‚Äî T√¨m code li√™n quan tr∆∞·ªõc khi implement</span>
      </div>

      <p>v5.2 th√™m <strong>memory index</strong>: agent index to√†n b·ªô <code>src/</code> sau m·ªói feature pass, search tr∆∞·ªõc khi implement feature m·ªõi. Tr√°nh duplicate code, t√°i s·ª≠ d·ª•ng utilities ƒë√£ c√≥.</p>

      <h3>C√°ch ho·∫°t ƒë·ªông</h3>

      <pre><span class="label">coding loop ‚Äî v5.2 memory integration</span>
<span class="cm"># Tr∆∞·ªõc khi implement feature:</span>
bash scripts/memory-search.sh <span class="st">"auth user login session"</span>
<span class="cm"># ‚Üí tr·∫£ v·ªÅ top 8 files li√™n quan v·ªõi exports + descriptions</span>
<span class="cm"># ‚Üí agent ƒë·ªçc 2-3 files quan tr·ªçng nh·∫•t ‚Üí hi·ªÉu patterns hi·ªán c√≥</span>

<span class="cm"># Sau khi feature pass (async, kh√¥ng block):</span>
bash scripts/memory-index.sh &amp;
<span class="cm"># ‚Üí rebuild .memory/index.json v·ªõi files m·ªõi v·ª´a t·∫°o</span></pre>

      <pre><span class="label">scripts/memory-search.sh ‚Äî output example</span>
[
  {
    "score": 3,
    "file": "src/lib/auth/session.ts",
    "exports": "createSession,validateSession,destroySession",
    "description": "Session management utilities for authenticated users"
  },
  {
    "score": 2,
    "file": "src/middleware/auth.ts",
    "exports": "withAuth,requireRole",
    "description": "Auth middleware ‚Äî wraps API routes with session check"
  },
  {
    "score": 1,
    "file": "src/hooks/useAuth.ts",
    "exports": "useAuth,useSession",
    "description": "React hook for accessing auth state"
  }
]</pre>

      <h3>Memory index structure</h3>

      <pre><span class="label">.memory/index.json</span>
[
  {
    "file": "src/lib/auth/session.ts",
    "exports": "createSession,validateSession,destroySession",
    "description": "Session management utilities for authenticated users",
    "lines": 87
  },
  ...
]
<span class="cm"># Rebuilt async sau m·ªói feature pass ‚Äî kh√¥ng block coding loop</span>
<span class="cm"># Session start: agent check s·ªë files indexed ƒë·ªÉ bi·∫øt index c√≥ fresh kh√¥ng</span></pre>

      <div class="note info">
        <b>T·∫°i sao c·∫ßn semantic memory?</b> Khi project c√≥ 50+ files, agent kh√¥ng th·ªÉ ƒë·ªçc h·∫øt m·ªói l·∫ßn implement feature m·ªõi. Memory index cho ph√©p t√¨m nhanh "file n√†o c√≥ auth utilities?" hay "ƒë√£ c√≥ component n√†o handle pagination ch∆∞a?" ‚Äî tr√°nh vi·∫øt l·∫°i code ƒë√£ c√≥.
      </div>

      <h3>Session start ‚Äî ki·ªÉm tra memory index</h3>

      <pre><span class="label">session start protocol ‚Äî v5.2</span>
<span class="cm"># B∆∞·ªõc 10 trong session start:</span>
[ -f .memory/index.json ] &amp;&amp; \
  echo "Memory: $(jq length .memory/index.json) files indexed"

<span class="cm"># N·∫øu index ch∆∞a c√≥ ho·∫∑c stale (>1 ng√†y):</span>
bash scripts/memory-index.sh</pre>
    </div>

    <!-- TL;DR -->
    <div class="step">
      <div class="step-head">
        <span class="step-num">TL;DR</span>
        <span class="step-title">To√†n b·ªô workflow trong 1 block</span>
      </div>

      <pre><span class="label">complete workflow</span>
<span class="cm"># ‚îÄ‚îÄ SETUP: GREENFIELD (project m·ªõi) ‚îÄ‚îÄ</span>
mkdir my-project &amp;&amp; cd my-project
<span class="cm"># T·∫°o AEGIS.md ‚Üí vi·∫øt y√™u c·∫ßu v√†o [Y√äU C·∫¶U C·ª¶A B·∫†N]</span>
<span class="cm"># Optionally set: MAX_COST_USD, EXECUTION_MODE, MAX_WORKERS</span>

<span class="cm"># ‚îÄ‚îÄ SETUP: EXISTING CODEBASE ‚îÄ‚îÄ</span>
<span class="kw">cd</span> /path/to/existing-project
<span class="cm"># T·∫°o AEGIS.md ‚Üí set PROJECT_MODE: existing (ho·∫∑c auto)</span>
<span class="cm"># Bootstrap s·∫Ω scan codebase, ƒë·ªçc .env keys, t·∫°o CODEBASE_SCAN.md</span>

<span class="cm"># ‚îÄ‚îÄ LAUNCH (c·∫£ 2 mode) ‚îÄ‚îÄ</span>
claude --model claude-opus-4-6 --dangerously-skip-permissions \
  -p "ƒê·ªçc AEGIS.md v√† th·ª±c hi·ªán Phase 0: Bootstrap r·ªìi b·∫Øt ƒë·∫ßu code."

<span class="cm"># ‚îÄ‚îÄ AUTO MODE (single agent) ‚îÄ‚îÄ</span>
chmod +x scripts/agent-watchdog.sh
tmux new-session -d -s agent 'bash scripts/agent-watchdog.sh'

<span class="cm"># ‚îÄ‚îÄ MULTI-AGENT MODE (khi project l·ªõn) ‚îÄ‚îÄ</span>
bash scripts/multi-agent.sh 3             <span class="cm"># 3 workers song song</span>

<span class="cm"># ‚îÄ‚îÄ T·ª™ PHONE ‚îÄ‚îÄ</span>
ssh me@dev-machine
bash scripts/health-check.sh              <span class="cm"># dashboard</span>
tail -20 LIVE_LOG.md                      <span class="cm"># real-time log</span>
cat .last_state.json | jq .               <span class="cm"># v5: agent state snapshot</span>
cat CODEBASE_SCAN.md                      <span class="cm"># existing mode: tech stack + what's already built</span>
jq length .memory/index.json             <span class="cm"># v5.2: bao nhi√™u files ƒë√£ indexed</span>
bash scripts/memory-search.sh "query"    <span class="cm"># v5.2: t√¨m code li√™n quan</span>
git tag -l "checkpoint/*"                 <span class="cm"># v5: active checkpoints</span>
cat NEEDS.md                              <span class="cm"># AI c·∫ßn g√¨ (existing: ch·ªâ keys th·ª±c s·ª± thi·∫øu)</span>
cat BLOCKED.md                            <span class="cm"># features b·ªã stuck (auto-rolled back)</span>
cat WORKERS.md                            <span class="cm"># multi-agent status</span>
echo "add-env VERCEL_TOKEN xxx" >> STEERING.md
echo "fix bug login page" >> STEERING.md
echo "unblock #7" >> STEERING.md
echo "pause" >> STEERING.md               <span class="cm"># d·ª´ng ƒë·ªÉ review</span>

<span class="cm"># Agent ch·∫°y li√™n t·ª•c. Check 2-3 l·∫ßn/ng√†y l√† ƒë·ªß.</span>
<span class="cm"># v5.2: Semantic memory ‚Äî search tr∆∞·ªõc implement, index sau pass.</span></pre>

    </div>

    <footer>
      <p>AEGIS v5.2 ‚Äî Autonomous Engineering &amp; Governance Intelligence System</p>
      <p style="margin-top:.3rem">Claude Opus 4.6 ¬∑ Checkpoint/Rollback ¬∑ Dependency Graph ¬∑ Thrashing Detection ¬∑ Staging Deploy ¬∑
        <strong>Multi-Agent with Heartbeat</strong> ¬∑ Stop Hook ¬∑ Supervision Level ¬∑ Existing Codebase Mode ¬∑ <strong>Semantic Memory</strong></p>
      <p style="margin-top:.3rem;font-size:.65rem">v5.2: Semantic memory index (memory-index.sh + memory-search.sh), agent searches before implement + rebuilds index async after pass ‚Äî plus all v5.1 features (Stop hook, PostToolUse lint, supervision_level, slash commands, CLAUDE.md Common Mistakes, Existing Codebase Mode) and v5 features (checkpoint/rollback, depends_on graph, thrashing detection, state snapshots, --continue timeout, worker heartbeat, staging‚Üíprod deploy, integration tests, idempotent bootstrap, flock for NFS)</p>
    </footer>

  </div>
</body>

</html>